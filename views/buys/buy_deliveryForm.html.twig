{% extends "dashboard.twig" %}
{% block content %}
    <div class="row">
        <div class="col-md-10">
            <h2> Albarán Compra </h2>
        </div>   
        <div class="col-md-2 d-flex justify-content-end align-items-end">
            <a class="link pr-4" href="/buys/buyDelieveries/list">Lista</a> 
            <a class="link " href="/admin">Volver</a> 
        </div>        
    </div>
    <div class="row">
        <div class="col">
            <div class="alert alert-dark" role="alert">
                {{ responseMessage }}
            </div>
        </div>
    </div>              
    <div class="form-row">
        <div class="col">
            <ul class="nav nav-tabs" id="myTab" role="tablist">
                <li class="nav-item" role="presentation">
                  <a class="nav-link active" id="provider-tab" data-toggle="tab" href="#provider" role="tab" aria-controls="provider" aria-selected="true">Proveedor</a>
                </li>
                <li class="nav-item" role="presentation">
                  <a class="nav-link" id="articles-tab" data-toggle="tab" href="#articles" role="tab" aria-controls="articles" aria-selected="false">Articulos</a>
                </li>
                <li class="nav-item" role="presentation">
                  <a class="nav-link" id="delivery-tab" data-toggle="tab" href="#delivery" role="tab" aria-controls="delivery" aria-selected="false">Albarán</a>
                </li>                            
            </ul>
        </div>
    </div>      
    <form action="/intranet/buys/buyDeliveries/save" method="post" class="form">
        <div class="tab-content" id="myTabContent">        
            <div class="tab-pane fade show active" id="provider" role="tabpanel" aria-labelledby="provider-tab">
                <div class="form-row mt-3">
                    <div class="form-group col text-right">
                        <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#searchProviderModal">
                            Buscar Proveedor
                        </button>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group col-md-2">
                          <label for="inputProviderID">ID</label>                        
                          <input type="text" name="provider_id" class="form-control" id="inputProviderId" placeholder="" value="{{ provider.id }}">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group col-md-9">
                        <label for="inputName">Nombre</label>                        
                        <input type="text" name="name" class="form-control" id="inputName" placeholder="" value="{{ provider.name }}">
                    </div>
                    <div class="form-group col-md-3">
                        <label for="inputFiscalId">DNI/CIF</label>
                        <input type="text" name="fiscal_id" class="form-control" id="inputFiscalId" placeholder="" value="{{ provider.fiscal_id }}">
                    </div>                    
                </div>
                <div class="form-row mb-3">
                    <div class="form-group col-md-4">
                        <label for="inputCity">Población</label>
                        <input type="text" name="city" class="form-control" id="inputCity" placeholder="" value="{{ provider.city }}">
                    </div>
                    <div class="form-group col-md-2">
                        <label for="inputPostalCode">C.P.</label>
                        <input type="text" name="cp" class="form-control" id="inputCp" placeholder="" value="{{ provider.postal_code }}">
                    </div>
                    <div class="form-group col-md-3">
                        <label for="inputState">Provincia</label>
                        <input type="text" name="state" class="form-control" id="inputState" placeholder="" value="{{ provider.state }}">
                    </div>
                    <div class="form-group col-md-3">
                        <label for="inputCountry">Pais</label>
                        <input type="text" name="country" class="form-control" id="inputCountry" placeholder="" value="{{ provider.country }}">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group col-md-3">
                        <label for="inputPhone">Teléfono</label>                        
                        <input type="text" name="phone" class="form-control" id="inputPhone" placeholder="" value="{{ provider.phone }}">
                    </div>
                    <div class="form-group col-md-5 offset-md-4">
                        <label for="inputFiscalId">Email</label>
                        <input type="text" name="email" class="form-control" id="inputEmail" placeholder="" value="{{ provider.email }}">
                    </div>                    
                </div>
            </div>                        
            <div class="tab-pane fade" id="articles" role="tabpanel" aria-labelledby="articles-tab">
                <div class="form-row mt-3">                                                      
                    <div class="form-group col">
                        <div class="form-group col text-right">
                        <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#searchArticlesModal">
                            Buscar Articulos
                        </button>
                    </div>
                    </div>
                </div>
                <div class="form-row">
                    <div class="col">
                        <table class="table">
                            <tr>
                                <th>MATRICULA/REFERENCIA</th>
                                <th>NOMBRE/DESCRIPCION</th>
                        </table>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group col">
                        <label for="observations">Comentarios</label>
                        <textarea class="form-control" name="vehicle_comments" id="vehicle_comments" rows="6">{{ buyDelivery.vehicle_comments }}</textarea>
                    </div>
                </div>
            </div>                        
            <div class="tab-pane fade" id="offer" role="tabpanel" aria-labelledby="offer-tab">
                <div class="form-row mt-3">
                    <div class="form-group col-md-1">
                          <label for="inputOfferID">ID</label>                        
                          <input type="text" name="id" class="form-control" id="inputId" placeholder="" value="{{ buyDelivery.id }}">
                    </div>
                    <div class="form-group col-md-2 offset-md-6">
                          <label for="inputOfferNumber">Numero de Oferta</label>                        
                          <input type="text" name="offer_number" class="form-control" id="inputOfferNumber" placeholder="" value="{{ buyDelivery.offer_number }}">
                    </div>
                    <div class="form-group col-md-2">
                          <label for="inputOfferDate">Fecha</label>                        
                          <input type="date" name="date" class="form-control" id="inputDate" placeholder="" value="{{ buyDelivery.offer_date }}">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group col">
                        <label for="texts">Textos</label>
                        <textarea class="form-control" name="texts" id="texts" rows="4">{{ buyDelivery.texts }}</textarea>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group col">
                        <label for="observations">Observaciones</label>
                        <textarea class="form-control" name="observations" id="observations" rows="4">{{ buyDelivery.observations }}</textarea>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group col-md-2 offset-md-4">
                        <label for="inputPrice">P.V.P.</label>
                        <input type="text" name="price" step="0.01" class="euros form-control" id="inputPrice" placeholder="" value="{{ vehicle.pvp }}">
                    </div>
                    <div class="form-group col-md-2">
                        <label for="inputDiscount">Descuento</label>
                        <input type="text" name="discount" step="0.01" class="euros form-control" id="inputDiscount" placeholder="" value="{{ buyDelivery.discount }}">
                    </div>
                    <div class="form-group col-md-2">
                        <label for="inputTva">I.V.A.</label>
                        <input type="text" name="tva" step="0.01" class="euros form-control" id="inputTva" placeholder="" value="{{ buyDelivery.tva }}">
                    </div>
                    <div class="form-group col-md-2">
                        <label for="inputTotal">Total</label>
                        <input type="text" name="total" class="euros form-control" id="inputTotal" placeholder="" value="{{ buyDelivery.total}}">
                    </div>
                </div>
            </div>
        </div>
        <div class="form-row">
            <div class="form-group col text-right">
                <button type="submit" class="btn btn-primary">Guardar</button>
                <a href="/admin" class="btn btn-primary">Cancelar</a>
            </div>
        </div> 
    </form>         
    <!-- Modal Providers -->
    <div class="modal fade" id="searchProviderModal" tabindex="-1" role="dialog" aria-labelledby="searchProviderModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl">
            <div class="modal-content ">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Clientes</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col">
                            <form id="searchProviderForm" action="/intranet/crm/offers/provider/search" method="post" class="form">
                                <div class="container">
                                    <div id="formRow" class="form-row text-right">
                                        <div class="col-11">                                                                                
                                            <input id="searchProviderField" type="text" name="searchProviderFilter" class="form-control mb-2 mr-sm-2" id="inlineFormSearchFilter" placeholder="Nombre / Cif / Telefono / email">
                                        </div>
                                        <div class="col-1">
                                            <button type="submit" class="btn btn-primary mb-2">Buscar</button>
                                        </div>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>                          
                        <div class="row">
                        <div class="col">
                            <table id="providersTable" class="table">
                                <tr>
                                    <th>Nombre</th>
                                    <th>Población</th>
                                    <th>Teléfono</th>
                                    <th>Email</th>
                                    <th>Edit</th>                                    
                                </tr>
                                
                                {% for provider in providers %}                                    
                                    <tr id="datarow">
                                        <td>{{ provider.name }}</td>
                                        <td>{{ provider.city }}</td>
                                        <td>{{ provider.phone }}</td>
                                        <td>{{ provider.email }}</td>
                                        <td><a href="/intranet/crm/offers/provider/select?provider_id={{provider.id}}&offer_id={{ offer.id }}&vehicle_id{{ vehicle.id }}">Select</a></td>                                        
                                    </tr>  
                                {% endfor %}                
                            </table>
                        </div>
                    </div>                    
                </div>
                <div class="modal-footer">
                  <button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>
                  
                </div>
            </div>
        </div>
    </div>                            
    {% block javascripts %}
        <script>
            {{ include('js/buyDeliveries.js')}}
         </script>
    {% endblock %}    
    <!-- Modal Vehicles -->
    <div class="modal fade" id="searchVehicleModal" tabindex="-1" role="dialog" aria-labelledby="searchVehicleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl">
            <div class="modal-content ">
                <div class="modal-header">
                    <h5 class="modal-title" id="ProviderModalLabel">Proveedores</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col">
                            <form id="searchVehicleForm" action="/sells/offers/vehicle/search" method="post" class="form">
                                <div class="container">
                                    <div id="formRow" class="form-row text-right">
                                        <div class="col-11">                                                                                
                                            <input id="searchVehicleField" type="text" name="searchVehicleFilter" class="form-control mb-2 mr-sm-2" placeholder=" Matricula / Bastidor / Marca / Modelo / Descripcion">
                                        </div>
                                        <div class="col-1">
                                            <button type="submit" class="btn btn-primary mb-2">Buscar</button>
                                        </div>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>                          
                    <div class="row">
                        <div class="col">
                            <table id="vehiclesTable" class="table">
                                <tr>
                                    <th>Matricula</th>
                                    <th>Bastidor</th>
                                    <th>Marca</th>
                                    <th>Modelo</th>
                                    <th>Descripcion</th>
                                    <th>Edit</th>                                    
                                </tr>
                                {% for vehicle in vehicles %}
                                    <tr>
                                        <td>{{ vehicle.plate }}</td>
                                        <td>{{ vehicle.vin }}</td>
                                        <td>{{ vehicle.brand }}</td>
                                        <td>{{ vehicle.model }}</td>
                                        <td>{{ vehicle.description }}</td>
                                        <td><a href="/intranet/crm/offers/vehicle/select?vehicle_id={{vehicle.id}}&offer_id={{ offer.id }}&provider_id={{ provider.id }}">Select</a></td>                                        
                                    </tr>
                                {% endfor %}                
                            </table>
                        </div>
                    </div>                    
                </div>
                <div class="modal-footer">
                  <button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>                  
                </div>
            </div>
        </div>
    </div>
{% endblock %}
